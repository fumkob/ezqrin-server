# Participant Endpoints

/events/{id}/participants:
  parameters:
    - $ref: '../components/parameters.yaml#/EventIDParam'
  get:
    tags:
      - participants
    summary: List participants for an event
    description: |
      Get a paginated list of participants for an event with search and filtering capabilities.
      Requires event owner or admin permissions. Staff access will be added in Phase 7.
    operationId: listParticipants
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../components/parameters.yaml#/PageParam'
      - $ref: '../components/parameters.yaml#/PerPageParam'
      - $ref: '../components/parameters.yaml#/SortParam'
      - $ref: '../components/parameters.yaml#/OrderParam'
      - name: search
        in: query
        description: Search by name, email, or employee_id (partial match)
        schema:
          type: string
          minLength: 1
          maxLength: 255
        example: "john"
      - name: status
        in: query
        description: Filter by participant status
        schema:
          $ref: '../schemas/enums.yaml#/ParticipantStatus'
    responses:
      '200':
        description: Successfully retrieved list of participants
        content:
          application/json:
            schema:
              $ref: '../schemas/participants.yaml#/ParticipantListResponse'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

  post:
    tags:
      - participants
    summary: Add a participant to an event
    description: |
      Register a new participant for an event. QR code is automatically generated.
      Requires event owner or admin permissions.
    operationId: createParticipant
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/participants.yaml#/CreateParticipantRequest'
    responses:
      '201':
        description: Participant successfully created with QR code
        content:
          application/json:
            schema:
              $ref: '../schemas/entities.yaml#/Participant'
      '400':
        $ref: '../components/responses.yaml#/BadRequest'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        description: Event not found
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
      '409':
        description: Conflict - Email already registered for this event
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
            example:
              type: "https://api.ezqrin.com/problems/conflict"
              title: "Conflict"
              status: 409
              detail: "A participant with this email is already registered for this event"
              instance: "/api/v1/events/123/participants"
              code: "DUPLICATE_EMAIL"
      '422':
        $ref: '../components/responses.yaml#/ValidationErrorResponse'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

/events/{id}/participants/bulk:
  parameters:
    - $ref: '../components/parameters.yaml#/EventIDParam'
  post:
    tags:
      - participants
    summary: Bulk import participants
    description: |
      Register multiple participants for an event in a single request (up to 1000 participants).
      QR codes are automatically generated for all participants.
      Requires event owner or admin permissions.
    operationId: bulkCreateParticipants
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/participants.yaml#/BulkCreateParticipantsRequest'
    responses:
      '201':
        description: Participants successfully created
        content:
          application/json:
            schema:
              $ref: '../schemas/participants.yaml#/BulkCreateParticipantsResponse'
      '400':
        $ref: '../components/responses.yaml#/BadRequest'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        description: Event not found
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
      '409':
        description: Conflict - Duplicate emails in request or already registered
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
            example:
              type: "https://api.ezqrin.com/problems/conflict"
              title: "Conflict"
              status: 409
              detail: "Duplicate emails found in request or database"
              instance: "/api/v1/events/123/participants/bulk"
              code: "DUPLICATE_EMAILS"
              errors:
                - field: "participants[2].email"
                  message: "Email already registered for this event"
                - field: "participants[5].email"
                  message: "Duplicate email in request"
      '422':
        $ref: '../components/responses.yaml#/ValidationErrorResponse'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

/participants/{id}:
  parameters:
    - $ref: '../components/parameters.yaml#/ParticipantIDParam'
  get:
    tags:
      - participants
    summary: Get participant details
    description: |
      Get detailed information about a specific participant.
      Requires event owner or admin permissions.
    operationId: getParticipant
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Participant details retrieved successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/entities.yaml#/Participant'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

  put:
    tags:
      - participants
    summary: Update participant information
    description: |
      Update an existing participant's information.
      QR code cannot be changed through this endpoint.
      Requires event owner or admin permissions.
    operationId: updateParticipant
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/participants.yaml#/UpdateParticipantRequest'
    responses:
      '200':
        description: Participant updated successfully
        content:
          application/json:
            schema:
              $ref: '../schemas/entities.yaml#/Participant'
      '400':
        $ref: '../components/responses.yaml#/BadRequest'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '409':
        description: Conflict - Email already used by another participant
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
      '422':
        $ref: '../components/responses.yaml#/ValidationErrorResponse'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

  delete:
    tags:
      - participants
    summary: Delete a participant
    description: |
      Delete a participant from an event. This action cannot be undone.
      Requires event owner or admin permissions.
    operationId: deleteParticipant
    security:
      - bearerAuth: []
    responses:
      '204':
        description: Participant deleted successfully
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '500':
        $ref: '../components/responses.yaml#/InternalError'

/participants/{id}/qrcode:
  parameters:
    - $ref: '../components/parameters.yaml#/ParticipantIDParam'
  get:
    tags:
      - participants
      - qrcode
    summary: Download participant QR code
    description: |
      Download the QR code for a participant in the requested format (PNG or SVG).
      Requires event owner or admin permissions.
    operationId: downloadParticipantQRCode
    security:
      - bearerAuth: []
    parameters:
      - name: format
        in: query
        description: QR code format
        schema:
          type: string
          enum:
            - png
            - svg
          default: png
        example: "png"
      - name: size
        in: query
        description: QR code size in pixels (PNG only, min 100, max 2000)
        schema:
          type: integer
          minimum: 100
          maximum: 2000
          default: 512
        example: 512
    responses:
      '200':
        description: QR code image
        content:
          image/png:
            schema:
              type: string
              format: binary
              description: PNG image (when format=png)
          image/svg+xml:
            schema:
              type: string
              description: SVG image (when format=svg)
      '400':
        description: Invalid format or size parameter
        content:
          application/json:
            schema:
              $ref: '../schemas/responses.yaml#/ProblemDetails'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '500':
        $ref: '../components/responses.yaml#/InternalError'
